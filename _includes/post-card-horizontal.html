<div class="post-cards-wrapper">
    <div class="post-carousel">
        <button class="pc-arrow pc-left" aria-label="Posts anteriores" type="button">‹</button>

        <div class="pc-viewport">
            <div class="pc-track">
                {% for post in site.posts limit: 10 %}
                <div class="pc-item">
                    <div class="card">
                        {% if post.image %}
                        <div class="card-image">
                            <img src="{{ post.image }}" alt="{{ post.title }}">
                        </div>
                        {% else %}
                        <header class="card-header">
                            <a class="card-header-title" href="{{ site.baseurl }}{{ post.url }}">{{ post.title }}</a>
                        </header>
                        {% endif %}
                        <div class="card-content">
                            <div class="content">
                                {% if post.image %}
                                <a class="title is-5" href="{{ site.baseurl }}{{ post.url }}">{{ post.title }}</a>
                                {% endif %}
                                {% if post.summary %}
                                {{ post.summary | markdownify }}
                                {% else %}
                                <p>{{ post.excerpt | truncatewords: 20 }}</p>
                                {% endif %}
                            </div>
                            <div class="has-text-centered">
                                <a href="{{ site.baseurl }}{{ post.url }}" class="button is-primary is-small">Ler mais
                                    <span class="is-sr-only"> sobre {{ post.title }}</span></a>
                            </div>
                        </div>
                        <footer class="card-footer">
                            <p class="card-footer-item">{{ post.date | date: '%d de %b, %Y' }}</p>
                        </footer>
                    </div>
                </div>
                {% endfor %}

                <!-- Botão para ir à página oficial de posts -->
                <div class="pc-item pc-view-all">
                    <div class="view-all-card">
                        <div class="view-all-content">
                            <h3>Mais Posts</h3>
                            <p>Confira todos os posts do nosso blog</p>
                            <a href="{{ site.baseurl }}/blog/" class="button is-primary">Ver Todos</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <button class="pc-arrow pc-right" aria-label="Próximos posts" type="button">›</button>
    </div>

    <style>
        .post-carousel {
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            width: 100%;
            box-sizing: border-box;
        }

        .pc-arrow {
            background: #111;
            color: #fff;
            border: none;
            padding: 10px 14px;
            cursor: pointer;
            font-size: 22px;
            border-radius: 4px;
            transition: background .2s ease;
            flex-shrink: 0;
        }

        .pc-arrow:hover:not(:disabled) {
            background: #333;
        }

        .pc-arrow:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pc-viewport {
            overflow: hidden;
            flex: 1;
        }

        .pc-track {
            display: flex;
            transition: transform .35s ease;
            gap: 16px;
            padding: 8px 0;
        }

        .pc-item {
            flex: 0 0 calc(33.333% - 11px);
            /* mostra 3 posts por vez por padrão */
            box-sizing: border-box;
        }

        .pc-item .card {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .pc-item .card-content {
            flex: 1;
        }

        .view-all-card {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 6px;
            padding: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #fff;
        }

        .view-all-content h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: #fff;
        }

        .view-all-content p {
            margin-bottom: 1.5rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .view-all-card .button {
            background: #fff;
            color: #667eea;
        }

        .view-all-card .button:hover {
            background: #f0f0f0;
        }

        /* Tablet mostra 2 posts */
        @media (max-width: 1024px) {
            .pc-item {
                flex: 0 0 calc(50% - 8px);
            }
        }

        /* Mobile mostra 1 post */
        @media (max-width: 640px) {
            .pc-item {
                flex: 0 0 100%;
            }

            .pc-arrow {
                padding: 8px 10px;
                font-size: 18px;
            }
        }
    </style>

    <script>
        (function () {
            const root = document.currentScript ? document.currentScript.parentElement : document.querySelector('.post-carousel');
            if (!root) return;
            const track = root.querySelector('.pc-track');
            const items = Array.from(root.querySelectorAll('.pc-item'));
            const btnPrev = root.querySelector('.pc-left');
            const btnNext = root.querySelector('.pc-right');

            let index = 0;

            function visibleCount() {
                if (window.matchMedia('(max-width: 640px)').matches) return 1;
                if (window.matchMedia('(max-width: 1024px)').matches) return 2;
                return 3;
            }

            function clampIndex(i) {
                const maxStart = Math.max(0, items.length - visibleCount());
                return Math.min(Math.max(0, i), maxStart);
            }

            function update() {
                const vc = visibleCount();
                const itemWidth = items[0] ? items[0].getBoundingClientRect().width : 0;
                const gap = parseFloat(getComputedStyle(track).gap) || 16;
                const offset = (itemWidth + gap) * index;
                track.style.transform = `translateX(-${offset}px)`;
                btnPrev.disabled = index === 0;
                btnNext.disabled = index >= Math.max(0, items.length - vc);
            }

            btnPrev.addEventListener('click', () => {
                index = clampIndex(index - 1);
                update();
            });
            btnNext.addEventListener('click', () => {
                index = clampIndex(index + 1);
                update();
            });

            window.addEventListener('resize', () => {
                index = clampIndex(index);
                update();
            });

            update();
        })();
    </script>
</div>